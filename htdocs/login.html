<!DOCTYPE html>
<html>
    <head>
        <title>Janox :: login - Applications access</title>

<script src='js/md5.js'></script>
<script>

    function jx_storeInfo(nome, valore) {

        expireDate = (new Date((new Date()).getTime() + 2592000000)).toGMTString();
        cookieText = nome + "=" + escape(valore) + ";";
        cookieText+= "expires=" + expireDate + ";";
        document.cookie = cookieText;

        }

    function jx_storeAll(appList,
                         appName,
                         appAlias,
                         userName,
                         userPswd,
                         devName,
                         devPswd,
                         clearPswd) {

        jx_storeInfo("jxapplist", appList);
        jx_storeInfo("jxapplast", appName);
        if (appName != "") {
            jx_storeInfo(appName,
                         appAlias + ";" + userName + ";" + userPswd + ";" +
                         devName + ";" + devPswd + ";" + clearPswd);
            }

        }

    function jx_getInfo(nome) {

        p_v = "";
        p_n = "" + nome;
        a_c = document.cookie;
        p_s = a_c.indexOf(p_n + "=") + p_n.length + 1;
        if (p_s != -1) {
            p_e = a_c.indexOf(";", p_s);
            if (p_e == -1) {
                p_e = a_c.length;
                }
            p_v = a_c.substring(p_s, p_e);
            p_v = unescape(p_v);
            }
        return p_v;

        }

    function jx_readAll() {

        appList = "";
        appList = jx_getInfo("jxapplist");
        if(appList != "") {
            appArray = appList.split(",");
            for (indiceApp in appArray) {
                if (appArray[indiceApp] != "") {
                    document.data.app_name.options[indiceApp] =
                     new Option(appArray[indiceApp], appArray[indiceApp]);
                    }
                }
            }
        document.data.app_name.value = jx_getInfo("jxapplast");
        if (document.data.app_name.value != "") {
            jx_readAppInfo(document.data.app_name.value);
            }

        }

    function jx_readAppInfo(nomeApp) {

        infoText = jx_getInfo(nomeApp);
        if (infoText != "") {
            tutteInfo                      = infoText.split(";");
            document.data.app_alias.value  = tutteInfo[0];
            document.data.jxuser.value     = tutteInfo[1];
            document.data.jxpassword.value = tutteInfo[2];
            document.data.jxdev.value      = tutteInfo[3];
            document.data.jxkey.value      = tutteInfo[4];
            document.data.jxclear.checked  = tutteInfo[5] == '1';
            }

        }

    function jx_addapp() {

        a_name = prompt("Enter new application name:");
        if (a_name != "") {
            n_i = document.data.app_name.options.length;
            document.data.app_name.options[n_i] = new Option(a_name, a_name, false, true);
            document.data.app_alias.value       = a_name;
            document.data.jxdev.value           = "supervisor";
            document.data.jxuser.value          = "root";
            document.data.jxclear.checked       = false;
            }

        }

    function jx_delapp() {

        document.data.app_name.options[document.data.app_name.selectedIndex] = null;

        }

    function jx_show_md5() {

        ht = "<br><br><center>Password MD5 encripted value: <h4>" +
              hex_md5(document.data.jxpassword.value) + "</h4></center>";
        document.body.innerHTML = ht;

        }

    function jx_login() {

        with (document.data) {
            if (jxpassword.value.length < 32 && !jxclear.checked) {
                jxpassword.value = hex_md5(jxpassword.value);
                }
            if (jxkey.value.length < 32) {
                jxkey.value = hex_md5(jxkey.value);
                }
            var appName   = app_name.value;
            var appAlias  = app_alias.value;
            var userName  = jxuser.value;
            var userPswd  = jxpassword.value;
            var devName   = jxdev.value;
            var devPswd   = jxkey.value;
            var devTrace  = (jxtrace.checked ? "1" : "");
            var clearPswd = (jxclear.checked ? "1" : "");
            var appList   = "";
            for (s_i = 0; s_i < app_name.options.length; s_i++) {
                appList+= (s_i > 0 ? "," : "") + app_name.options[s_i].text;
                }
            }
        document.body.innerHTML = '<br><br><center>Connecting to application: <h4>' +
                                  appName + '</h4></center>';
        jx_storeAll(appList,
                    appName,
                    appAlias,
                    userName,
                    userPswd,
                    devName,
                    devPswd,
                    clearPswd);
        parent.load_app(appName,
                        appAlias,
                        userName,
                        userPswd,
                        devName,
                        devPswd,
                        devTrace,
                        clearPswd);
        return false;

        }

</script>

        <style type="text/css">
        <!--
        @font-face {
            font-family: 'Gudea';
            font-style: normal;
            font-weight: 400;
            src: local('Gudea'), url(css/fonts/gudea.woff) format('woff');
            }

        * { font-family: "Gudea", sans-serif; color: #000000; font-size: 13px; box-sizing: border-box; }

        body {
         color: #666666;
         background-color: #fefefe;
         margin: 0;
         }
        .frame {
         background-color: #f5f5f5;
         border: none;
         width: 240px;
         border-bottom-left-radius: 10px;
         border-bottom-right-radius: 10px;
         border-collapse: collapse;
         box-shadow: 0px 5px 5px #cccccc;
         }
        .label {
         color: #fefefe;
         background-color: #999999;
         line-height: 20px;
         text-align: center;
         width: 100%;
         }
        .info {
         padding: 5px;
         padding-left: 10px;
         padding-right: 10px;
         }
        .app {
         width: 100%;
         height: 20px;
         }
        .field {
         background-color: #ffffff;
         border: 1px solid #cccccc;
         padding-left: 4px;
         padding-right: 4px;
         width: 100%;
         height: 20px;
         }
        .dev {
         font-style: italic;
         }
        .btn {
         color: #fefefe;
         background-color: #999999;
         text-align: center;
         border: 1px solid #999999;
         border-radius: 3px;
         }
        .btn:hover {
         color: #fefefe;
         background-color: #bbbbbb;
         text-align: center;
         border-bottom: 1px solid #a19a93;
         border-top: 1px solid #D1C9C1;
         border-left: 1px solid #BDB5AE;
         border-right: 1px solid #BDB5AE;
         border-radius: 3px;
         cursor: pointer;
         }
         -->
        </style>

    </head>

    <body onload="jx_readAll();">
     <form name="data"
           method="post"
           action=""
           onSubmit="jx_login(); return false;">
      <table align="center" cellspacing="20px" cellpadding="0">
      <tr><td>
      <table align="center" class="frame">
       <tr>
        <td class="label">Application</td>
       </tr>
       <tr>
        <td class="info">
         <select name="app_name"
                 size="1"
                 class="app"
                 title="Application name"
                 onchange="jx_readAppInfo(this.value);"></select>
        </td>
       </tr>
       <tr>
        <td class="info"><input name="app_alias"
                   size="15"
                   maxlength="50"
                   type="text"
                   value=""
                   class="field"
                   title="Application alias"
                   placeholder="Application alias">
        </td>
       </tr>
       <tr>
        <td class="info" align="right">
         <input type="button"
                name="new_app"
                title="Register application"
                value="Register"
                class="btn"
                onClick="jx_addapp();"
                tabindex="-1">
         <input type="button"
                name="new_app"
                title="Remove application"
                value="Remove"
                class="btn"
                onClick="jx_delapp();"
                tabindex="-1">
        </td>
       </tr>
      </table>
      </td>
      <td>
      <table align="center" class="frame">
       <tr>
        <td class="label" colspan="2">Credentials</td>
       </tr>
       <tr>
        <td class="info" colspan="2"><input name="jxuser"
                   size="15"
                   maxlength="30"
                   type="text"
                   value=""
                   class="field"
                   title="User ID"
                   placeholder="User ID">
        </td>
       </tr>
       <tr>
        <td class="info" colspan="2"><input name="jxpassword"
                   size="15"
                   maxlength="32"
                   type="password"
                   value=""
                   class="field"
                   title="Password"
                   placeholder="Password">
        </td>
       </tr>
       <tr>
        <td class="info">Clear password:
         <input name="jxclear"
                type="checkbox"
                onchange="if(this.checked){alert('Sending password clear is unsafe!\nUse only in private or secure networks.');}">
        </td>
        <td class="info" align="right">
         <input type="button"
                name="show_md5"
                title="Show MD5 hashed password"
                onClick="jx_show_md5();"
                value="MD5"
                class="btn"
                tabindex="-1">
        </td>
       </tr>
      </table>
      </td>
      </tr>
      <tr>
      <td>
      <table align="center" class="frame" style="opacity:0.6;">
       <tr>
        <td class="label dev">Development</td>
       </tr>
       <tr>
        <td class="info"><input name="jxdev"
                   size="15"
                   maxlength="30"
                   type="text"
                   class="field dev"
                   title="Developer ID"
                   placeholder="Developer">
        </td>
       </tr>
       <tr>
        <td class="info"><input name="jxkey"
                   size="15"
                   maxlength="32"
                   type="password"
                   class="field dev"
                   title="Developer password"
                   placeholder="Developer password">
        </td>
       </tr>
       <tr>
        <td class="info dev" align="right" title="Start tracing SQL activity">DB log:
         <input name="jxtrace"
                type="checkbox">
        </td>
       </tr>
      </table>
      </td>
      <td>
      <table align="center">
       <tr>
        <tr><td>&nbsp;</td></tr>
        <td align="center">
         <input type="submit"
                value="Login"
                title="Login to the selected application"
                class="btn"
                style="width:90px;height:30px;box-shadow: 0px 5px 5px #cccccc;">
        </td>
       </tr>
      </table>
     </td>
     </tr>
     </table>
     </form>
    </body>

</html>
